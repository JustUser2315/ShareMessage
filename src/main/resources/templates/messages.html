<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <th:block th:insert="/fragments/bootstrap/bootstrap::bootstrap_hat"/>
    <meta charset="UTF-8">
    <title>Messages</title>
</head>
<body>
<th:block th:insert="~{/fragments/bootstrap/bootstrap::bootstrap_body}"/>
<th:block th:insert="~{/fragments/bootstrap/bootstrap::NavBarForLoggedUser}"/>

<div id="ALL MESSAGES">
<form th:action="@{/messages}">
    <H1>All Messages</H1>
   <div id="FILTER">
       Filter:
       <div>
           <input type="text" name="text" placeholder="TextFilter">
       </div>
       <div>
           <input type="text" name="tag" placeholder="TagFilter">
       </div>
       <button type="submit">Filter</button>
   </div>

   <div id="PAGE">
       Page:
       <div>
           <input type="number" name="page" placeholder="Page" th:value="${messages.getMetadata().getNumberOfPage()}">
       </div>
       <div>
           <input type="number" name="size" placeholder="Size" th:value="${messages.getMetadata().getSize()}">
       </div>
       <button type="submit">Page filter</button>
   </div>

<div id="MESSAGES ON PAGE">
    <th:block >
        <div class="card-columns" >
            <div class="card text-white bg-dark mb-3 card border-info" style="max-width: 18rem;" th:each="m:${messages.getContent()}">
                <a th:if="${user.getId()==m.getAuthorId()}" th:href="@{user/{id}/profile/(id=${m.getAuthorId()})}"><img th:src="@{/user/{id}/profile/avatar(id=${m.getAuthorId()})}" alt="User avatar" width="50" height="50" onerror="this.style.display='none'"/></a>
                <a th:if="${user.getId()!=m.getAuthorId()}" th:href="@{user/{id}/profile/show(id=${m.getAuthorId()})}"><img th:src="@{/user/{id}/profile/avatar(id=${m.getAuthorId()})}" alt="User avatar" width="50" height="50" onerror="this.style.display='none'"/></a>
                <h5 style="color: darkgreen" class="card-title" th:text="${m.getAuthorUsername()}">Card title</h5>
                <img class="card-img-top" th:src="@{/messages/{id}/picture(id=${m.getId()})}" alt="Card image cap" onerror="this.style.display='none'">
                <div class="card-body">
                    <p class="card-text" th:text="${m.getText()}">message text</p>
                    <h6 style="color: pink"  class="card-subtitle mb-2 text" th:text="${m.getTag()}">message tag</h6>
                    <a th:text="${m.getLikes().stream().count()}"></a>
                    <th:block th:if="${!notLiked.contains(m.getId())}">
                    <form th:action="@{/user/dislike/{messageId}(messageId=${m.getId()})}" method="post">
                        <button class="fa-solid fa-heart" type="submit"></button>
                    </form>
                    </th:block>
                    <th:block th:if="${notLiked.contains(m.getId())}">
                        <form th:action="@{/user/like/{messageId}(messageId=${m.getId()})}" method="post">
                            <button class="fa-regular fa-heart" type="submit"></button>
                        </form>
                    </th:block>
                </div>
            </div>
        </div>
    </th:block>
</div>
</form>
</div>
</body>
</html>